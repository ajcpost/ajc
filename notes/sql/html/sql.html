<?xml version="1.0" encoding="iso-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="content-type" content="text/html; charset=iso-8859-1" />
  <title>New</title>
  <meta name="generator" content="Amaya, see http://www.w3.org/Amaya/" />
</head>

<body>
<p></p>

<h1>SQL examples</h1>

<p></p>

<h2>Example#1, Retail store</h2>

<h3>Schema details</h3>
<ul>
  <li>Manufacturer (master table)</li>
  <li>Product category (master table)</li>
  <li>Products (master table)</li>
  <li>Customer (master table</li>
  <li>Sales (transactions table)</li>
</ul>

<p>-------------- select * from manufacturer -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>id</th>
      <th>name</th>
    </tr>
    <tr>
      <td>1</td>
      <td>motorola</td>
    </tr>
    <tr>
      <td>2</td>
      <td>htc</td>
    </tr>
    <tr>
      <td>3</td>
      <td>samsung</td>
    </tr>
    <tr>
      <td>4</td>
      <td>sony</td>
    </tr>
    <tr>
      <td>5</td>
      <td>apple</td>
    </tr>
    <tr>
      <td>6</td>
      <td>lg</td>
    </tr>
    <tr>
      <td>7</td>
      <td>nokia</td>
    </tr>
    <tr>
      <td>8</td>
      <td>acer</td>
    </tr>
    <tr>
      <td>9</td>
      <td>hp</td>
    </tr>
  </tbody>
</table>
<hr />

<p>-------------- select * from category -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>id</th>
      <th>category</th>
    </tr>
    <tr>
      <td>1</td>
      <td>smartphone</td>
    </tr>
    <tr>
      <td>2</td>
      <td>tablet</td>
    </tr>
    <tr>
      <td>3</td>
      <td>laptop</td>
    </tr>
  </tbody>
</table>
<hr />

<p>-------------- select * from product -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>price</th>
      <th>category</th>
      <th>manufacturer</th>
    </tr>
    <tr>
      <td>1</td>
      <td>moto-razor</td>
      <td>50</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>2</td>
      <td>moto-defy</td>
      <td>70</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>3</td>
      <td>moto-droid</td>
      <td>40</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>4</td>
      <td>htc-sp1</td>
      <td>75</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>5</td>
      <td>htc-sp2</td>
      <td>95</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>6</td>
      <td>htc-sp3</td>
      <td>45</td>
      <td>1</td>
      <td>2</td>
    </tr>
    <tr>
      <td>7</td>
      <td>samsung-sp1</td>
      <td>58</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <td>8</td>
      <td>samsung-sp2</td>
      <td>73</td>
      <td>1</td>
      <td>3</td>
    </tr>
    <tr>
      <td>9</td>
      <td>sony-sp1</td>
      <td>70</td>
      <td>1</td>
      <td>4</td>
    </tr>
    <tr>
      <td>10</td>
      <td>apple-sp1</td>
      <td>100</td>
      <td>1</td>
      <td>5</td>
    </tr>
    <tr>
      <td>11</td>
      <td>apple-laptop1</td>
      <td>200</td>
      <td>3</td>
      <td>5</td>
    </tr>
    <tr>
      <td>12</td>
      <td>lg-sp1</td>
      <td>65</td>
      <td>1</td>
      <td>6</td>
    </tr>
    <tr>
      <td>13</td>
      <td>lg-sp2</td>
      <td>80</td>
      <td>1</td>
      <td>6</td>
    </tr>
    <tr>
      <td>14</td>
      <td>nokia-sp1</td>
      <td>78</td>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <td>15</td>
      <td>nokia-sp1</td>
      <td>80</td>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <td>16</td>
      <td>nokia-sp1</td>
      <td>90</td>
      <td>1</td>
      <td>7</td>
    </tr>
    <tr>
      <td>17</td>
      <td>acer-tablet1</td>
      <td>100</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <td>18</td>
      <td>acer-tablet2</td>
      <td>120</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <td>19</td>
      <td>acer-laptop1</td>
      <td>150</td>
      <td>3</td>
      <td>8</td>
    </tr>
    <tr>
      <td>20</td>
      <td>hp-laptop1</td>
      <td>80</td>
      <td>3</td>
      <td>9</td>
    </tr>
    <tr>
      <td>21</td>
      <td>hp-laptop2</td>
      <td>140</td>
      <td>3</td>
      <td>9</td>
    </tr>
    <tr>
      <td>22</td>
      <td>hp-tablet1</td>
      <td>74</td>
      <td>2</td>
      <td>9</td>
    </tr>
    <tr>
      <td>23</td>
      <td>hp-tablet2</td>
      <td>85</td>
      <td>2</td>
      <td>9</td>
    </tr>
  </tbody>
</table>
<hr />

<p>-------------- select * from customer -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>id</th>
      <th>login</th>
      <th>name</th>
    </tr>
    <tr>
      <td>1</td>
      <td>aj</td>
      <td>ajay</td>
    </tr>
    <tr>
      <td>2</td>
      <td>john</td>
      <td>john</td>
    </tr>
    <tr>
      <td>3</td>
      <td>mike</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>4</td>
      <td>dave</td>
      <td>dave</td>
    </tr>
    <tr>
      <td>5</td>
      <td>chris</td>
      <td>chris</td>
    </tr>
  </tbody>
</table>
<hr />

<p>-------------- select * from sales -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>id</th>
      <th>product</th>
      <th>quantity</th>
      <th>login</th>
    </tr>
    <tr>
      <td>1</td>
      <td>2</td>
      <td>1</td>
      <td>aj</td>
    </tr>
    <tr>
      <td>2</td>
      <td>2</td>
      <td>1</td>
      <td>xx</td>
    </tr>
    <tr>
      <td>3</td>
      <td>19</td>
      <td>1</td>
      <td>aj</td>
    </tr>
    <tr>
      <td>4</td>
      <td>17</td>
      <td>1</td>
      <td>aj</td>
    </tr>
    <tr>
      <td>5</td>
      <td>1</td>
      <td>2</td>
      <td>john</td>
    </tr>
    <tr>
      <td>6</td>
      <td>23</td>
      <td>1</td>
      <td>john</td>
    </tr>
    <tr>
      <td>7</td>
      <td>3</td>
      <td>3</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>8</td>
      <td>5</td>
      <td>1</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>9</td>
      <td>13</td>
      <td>2</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>10</td>
      <td>7</td>
      <td>1</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>11</td>
      <td>12</td>
      <td>1</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>12</td>
      <td>5</td>
      <td>1</td>
      <td>mike</td>
    </tr>
    <tr>
      <td>13</td>
      <td>11</td>
      <td>10</td>
      <td>dave</td>
    </tr>
    <tr>
      <td>14</td>
      <td>21</td>
      <td>5</td>
      <td>dave</td>
    </tr>
  </tbody>
</table>
<hr />

<h3>Queries</h3>

<h4>Find customers who has done max no. of transactions by volume</h4>

<p><strong>Step#1</strong>, get a count of transactions per login</p>

<p>- select login, count(login) cnt from sales group by login;</p>

<p><strong>Step#2</strong>, get max of it.</p>

<p>- Multiple rows may have same count and hence it's not possible to use TOP
or limit clause and get the topmost row. Due to same issue, one can't directly
retrieve any other column along with MAX.</p>

<p>- select MAX(cnt) from (select login, count(login) cnt from sales group by
login) as p;</p>

<p><strong>Step#3</strong>, Use above as a subquery to compare the value and
get the login.</p>

<p></p>

<p>-------------- select login, count(login) from sales group by login having
count(login) = (select max(cnt) from (select login, count(login) cnt from sales
group by login) as p1) -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>login</th>
      <th>count(login)</th>
    </tr>
    <tr>
      <td>mike</td>
      <td>6</td>
    </tr>
  </tbody>
</table>
<hr />

<h4>Find customer who has done max no. of transactions by price</h4>

<p><strong>Step#1</strong>, get price info by joining with Product table</p>

<p>-select login, product.name, (quantity * product.price) amount, quantity
from sales join product on sales.product=product.id;</p>

<p><strong>Step#2</strong>, sum individual amounts to compute total per
login</p>

<p>- select login, SUM(amount) total from (select login, product.name,
(quantity * product.price) amount, quantity from sales join product on
sales.product=product.id) as p1 group by login;</p>

<p><strong>Step#3</strong>, get max of total</p>

<p>- select MAX(total) from (select login, SUM(amount) total from (select
login, product.name, (quantity * product.price) amount, quantity from sales
join product on sales.product=product.id) as p group by login) as p1;</p>

<p><strong>Step#4</strong>, use above in comparision</p>

<p>-------------- select login, SUM(amount) from (select login, product.name,
(quantity * product.price) amount, quantity from sales join product on
sales.product=product.id) as p group by login having SUM(amount) = (select
MAX(total) from (select login, SUM(amount) total from (select login,
product.name, (quantity * product.price) amount, quantity from sales join
product on sales.product = product.id) as p1 group by login) as p2)
-------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>login</th>
      <th>SUM(amount)</th>
    </tr>
    <tr>
      <td>dave</td>
      <td>2700</td>
    </tr>
  </tbody>
</table>
<hr />

<h4>Find products which are not sold and display their category,
manufacturer</h4>

<p>-------------- select pd.name, pd.price, cat.category, manf.name from
product pd, category cat, manufacturer manf where pd.category = cat.id and
pd.manufacturer = manf.id and pd.id not in (select distinct product from sales)
-------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>name</th>
      <th>price</th>
      <th>category</th>
      <th>name</th>
    </tr>
    <tr>
      <td>htc-sp1</td>
      <td>75</td>
      <td>smartphone</td>
      <td>htc</td>
    </tr>
    <tr>
      <td>htc-sp3</td>
      <td>45</td>
      <td>smartphone</td>
      <td>htc</td>
    </tr>
    <tr>
      <td>samsung-sp2</td>
      <td>73</td>
      <td>smartphone</td>
      <td>samsung</td>
    </tr>
    <tr>
      <td>sony-sp1</td>
      <td>70</td>
      <td>smartphone</td>
      <td>sony</td>
    </tr>
    <tr>
      <td>apple-sp1</td>
      <td>100</td>
      <td>smartphone</td>
      <td>apple</td>
    </tr>
    <tr>
      <td>nokia-sp1</td>
      <td>78</td>
      <td>smartphone</td>
      <td>nokia</td>
    </tr>
    <tr>
      <td>nokia-sp1</td>
      <td>80</td>
      <td>smartphone</td>
      <td>nokia</td>
    </tr>
    <tr>
      <td>nokia-sp1</td>
      <td>90</td>
      <td>smartphone</td>
      <td>nokia</td>
    </tr>
    <tr>
      <td>acer-tablet2</td>
      <td>120</td>
      <td>tablet</td>
      <td>acer</td>
    </tr>
    <tr>
      <td>hp-laptop1</td>
      <td>80</td>
      <td>laptop</td>
      <td>hp</td>
    </tr>
    <tr>
      <td>hp-tablet1</td>
      <td>74</td>
      <td>tablet</td>
      <td>hp</td>
    </tr>
  </tbody>
</table>
<hr />

<h4>Find a product which is least sold</h4>

<p><strong>Step#1</strong>, get sum of all the product quantities sold</p>

<p>-select product, SUM(quantity) total from sales group by product;</p>

<p><strong>Step#2</strong>, Find min</p>

<p>- Multiple rows may have same count and hence it's not possible to use TOP
or limit clause and get the topmost row. Due to same issue, one can't directly
retrieve any other column along with MIN..</p>

<p>-select MIN(total) from (select product, SUM(quantity) total from sales
group by product) as p;</p>

<p><strong>Step#3</strong>, use above in comparision</p>

<p>-------------- select product, SUM(quantity) total from sales group by
product having total = (select MIN(total) from (select product, SUM(quantity)
total from sales group by product) as p) -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>product</th>
      <th>total</th>
    </tr>
    <tr>
      <td>7</td>
      <td>1</td>
    </tr>
    <tr>
      <td>12</td>
      <td>1</td>
    </tr>
    <tr>
      <td>17</td>
      <td>1</td>
    </tr>
    <tr>
      <td>19</td>
      <td>1</td>
    </tr>
    <tr>
      <td>23</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
<hr />

<h4>Find products purchased by aj</h4>

<p>-------------- select * from product where id in (select distinct product
from sales where login = 'aj') -------------- </p>

<table border="1">
  <tbody>
    <tr>
      <th>id</th>
      <th>name</th>
      <th>price</th>
      <th>category</th>
      <th>manufacturer</th>
    </tr>
    <tr>
      <td>2</td>
      <td>moto-defy</td>
      <td>70</td>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <td>17</td>
      <td>acer-tablet1</td>
      <td>100</td>
      <td>2</td>
      <td>8</td>
    </tr>
    <tr>
      <td>19</td>
      <td>acer-laptop1</td>
      <td>150</td>
      <td>3</td>
      <td>8</td>
    </tr>
  </tbody>
</table>
Bye </body>
</html>
