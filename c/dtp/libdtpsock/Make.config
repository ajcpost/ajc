
include ../Make.config
PROJ_SRC=$(ROOT_SRC)/libdtpsock
PROJ_BUILD=$(ROOT_BUILD)/libdtpsock

# Project Paths
SRC_DIRS=main/src test/src/common test/src/client test/src/server
INC_DIRS=main/include test/include test/include/common
INC=$(addprefix -I$(PROJ_SRC)/, $(INC_DIRS))
SRC=$(addprefix $(PROJ_SRC)/, $(SRC_DIRS))
TGTS=$(addprefix $(PROJ_BUILD)/, $(SRC_DIRS))

## External Paths
MISC_SRC=$(ROOT_SRC)/libdtpmisc
MISC_INC_DIRS=main/include
MISC_INC=$(addprefix -I$(MISC_SRC)/, $(MISC_INC_DIRS))
EXTERNAL_INC=$(MISC_INC)

## Libs
DTP_LIB=$(ROOT_BUILD)/libdtpsock
MISC_LIB=$(ROOT_BUILD)/libdtpmisc
LIB_FLAG=-L$(DTP_LIB) -L$(MISC_LIB)
LIBS=-ldtpmisc -ldtpsock -lsctp -lpthread

## Additional config per target
T1_SRC_DIRS=main/src
T1_SRC=$(foreach dir, $(T1_SRC_DIRS), $(wildcard $(dir)/*.c))
T1_TMP=$(addprefix $(PROJ_BUILD)/,$(T1_SRC))
T1_OBJ=$(patsubst %.c, %.o, $(T1_TMP))

T2_SRC_DIRS=test/src test/src/common test/src/client
T2_SRC=$(foreach dir, $(T2_SRC_DIRS), $(wildcard $(dir)/*.c))
T2_TMP=$(addprefix $(PROJ_BUILD)/,$(T2_SRC))
T2_OBJ=$(patsubst %.c, %.o, $(T2_TMP))

T3_SRC_DIRS=test/src test/src/common test/src/server
T3_SRC=$(foreach dir, $(T3_SRC_DIRS), $(wildcard $(dir)/*.c))
T3_TMP=$(addprefix $(PROJ_BUILD)/,$(T3_SRC))
T3_OBJ=$(patsubst %.c, %.o, $(T3_TMP))

# Macros
vpath %.c $(SRC)
define make-goal
$1/%.o: %.c
	$(CC) $(INC) $(EXTERNAL_INC) -c $$< -o $$@
endef
